# P2P Implementation Checklist

## ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [x] `src/services/p2pInit.ts` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ peerId
- [x] `src/services/dhtRegistry.ts` - DHT —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
- [x] `src/services/peerRegistry.ts` - –†–µ–µ—Å—Ç—Ä –ø–∏—Ä–æ–≤ —Å publicKey –∫–∞–∫ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- [x] `src/services/peerSearch.ts` - –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø–∏—Ä–æ–≤
- [x] `src/services/versionedStore.ts` - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å CRDT
- [x] `src/services/pubsub.ts` - Pub/Sub –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [x] `src/services/p2pSync.ts` - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [x] `src/services/p2pLogger.ts` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- [x] `src/services/p2pNetworkNew.ts` - –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è P2P —Å–µ—Ç—å —Å DHT –∏ hole punching

## üìù –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [x] `src/services/messageQueue.ts` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è P2PSync –∏ P2PInitializer

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [x] `P2P_INTEGRATION_GUIDE.md` - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [x] `P2P_USAGE_EXAMPLES.md` - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- [x] `P2P_IMPLEMENTATION_CHECKLIST.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

## üîß –®–∞–≥–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 —á–∞—Å–∞)

- [ ] –î–æ–±–∞–≤–∏—Ç—å `StorageKeys.PEER_ID` –∏ `StorageKeys.PUBLIC_KEY` –≤ `src/services/storage.ts`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `Config.BOOTSTRAP_NODES` –∏ `Config.RELAY_URLS` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `Config.ICE_SERVERS` —Å–æ–¥–µ—Ä–∂–∏—Ç STUN/TURN —Å–µ—Ä–≤–µ—Ä—ã

### –§–∞–∑–∞ 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (1-2 —á–∞—Å–∞)

- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é P2P –≤ `src/App.tsx`:
  ```typescript
  import { P2PInitializer } from './services/p2pInit';
  
  useEffect(() => {
    P2PInitializer.initializePeer();
  }, []);
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
  ```
  ‚úì P2P Peer initialized: Qm...
  ‚úì Registered in DHT: Qm...
  ‚úì MessageQueue initialized: Qm...
  ```

### –§–∞–∑–∞ 3: –ü–æ–∏—Å–∫ –ø–∏—Ä–æ–≤ (2-3 —á–∞—Å–∞)

- [ ] –û–±–Ω–æ–≤–∏—Ç—å —ç–∫—Ä–∞–Ω –ø–æ–∏—Å–∫–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `PeerSearch`:
  ```typescript
  import { PeerSearch } from './services/peerSearch';
  
  const peer = await PeerSearch.searchByUsername(username);
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã (–Ω–µ—Ç –¥—É–±–ª–µ–π)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
  ```
  ‚úì Found in local registry: username
  ‚úì Peer registered: Qm... username
  ```

### –§–∞–∑–∞ 4: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (2-3 —á–∞—Å–∞)

- [ ] –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `messageQueue.sendMessage()`:
  ```typescript
  const success = await messageQueue.sendMessage({
    id: messageId,
    chatId: chatId,
    peerId: toPeerId,
    content,
    type: 'text',
    createdAt: Date.now(),
    retries: 0
  });
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
  ```
  ‚úì Data channel opened: Qm...
  ‚úì Message sent via direct channel: Qm...
  ‚Üí Falling back to relay: Qm...
  ```

### –§–∞–∑–∞ 5: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è (2-3 —á–∞—Å–∞)

- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `messageQueue.updateUserProfile()`:
  ```typescript
  await messageQueue.updateUserProfile(profile);
  ```

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
  ```
  ‚úì Profile synced: username
  ‚úì Published to topic: profile:update
  ```

### –§–∞–∑–∞ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3-4 —á–∞—Å–∞)

- [ ] –¢–µ—Å—Ç 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ peerId —Å–æ–∑–¥–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ DHT

- [ ] –¢–µ—Å—Ç 2: –ü–æ–∏—Å–∫
  - [ ] –°–æ–∑–¥–∞—Ç—å –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - [ ] –û–¥–∏–Ω –∏—â–µ—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ username
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω (–æ–¥–∏–Ω –ø—Ä–æ—Ñ–∏–ª—å, –Ω–µ –¥—É–±–ª–∏)

- [ ] –¢–µ—Å—Ç 3: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
  - [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è –ø–∏—Ä–∞–º–∏
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∏—Ç
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ (direct channel –∏–ª–∏ relay)

- [ ] –¢–µ—Å—Ç 4: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
  - [ ] –ò–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ pub/sub

- [ ] –¢–µ—Å—Ç 5: Offline —Ä–µ–∂–∏–º
  - [ ] –û—Ç–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
  - [ ] –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  - [ ] –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–æ—Å—å

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º:
```
[2025-12-30T20:20:57.917Z] [STAGE] ‚úì/‚úó Message
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä –≤ –∫–æ–Ω—Å–æ–ª–∏:
```javascript
// –¢–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
console.log = ((f) => (...args) => {
  if (args[0]?.includes('‚úì')) f(...args);
})(console.log);

// –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
console.error = ((f) => (...args) => {
  if (args[0]?.includes('‚úó')) f(...args);
})(console.error);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ Debug Screen –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```typescript
// src/screens/DebugScreen.tsx
const DebugScreen = () => {
  const [info, setInfo] = useState<any>(null);

  useEffect(() => {
    const load = async () => {
      const peerId = await P2PInitializer.getPeerId();
      const peers = await PeerRegistry.getAllPeers();
      setInfo({ peerId, peerCount: peers.length });
    };
    load();
  }, []);

  return <Text>{JSON.stringify(info, null, 2)}</Text>;
};
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- **DHT —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ peerId –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ DHT
- **–ü—Ä—è–º—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö data channels
- **Relay –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ—Ü–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ relay vs direct
- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –í—Ä–µ–º—è –º–µ–∂–¥—É –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π
- **–ü–æ–∏—Å–∫**: –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ –ø–∏—Ä–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–π vs relay)

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

–ü–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã:

1. **WebSocket –≤–º–µ—Å—Ç–æ HTTP polling**
   - –ó–∞–º–µ–Ω–∏—Ç—å HTTP polling –Ω–∞ WebSocket –¥–ª—è pub/sub
   - –£–º–µ–Ω—å—à–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å 5 —Å–µ–∫ –¥–æ 1 —Å–µ–∫

2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞**
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –Ω–∞ 1 —á–∞—Å
   - –û–±–Ω–æ–≤–ª—è—Ç—å –∫—ç—à –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è

3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DHT**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DHT –Ω–∞ bootstrap —Å–µ—Ä–≤–µ—Ä–µ
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å libp2p Kademlia –≤–º–µ—Å—Ç–æ HTTP

4. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ E2E**
   - –î–æ–±–∞–≤–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å public key –ø–∏—Ä–∞ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

5. **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
   - –†–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ 3+ –ø–∏—Ä–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DHT –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ P2PLogger)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (Config.ts)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ bootstrap –∏ relay —Å–µ—Ä–≤–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ICE servers —Ä–∞–±–æ—Ç–∞—é—Ç
5. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Debug Screen –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üìÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞

- **–§–∞–∑–∞ 1-2**: 2-4 —á–∞—Å–∞ (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
- **–§–∞–∑–∞ 3-4**: 4-6 —á–∞—Å–æ–≤ (–ø–æ–∏—Å–∫ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è)
- **–§–∞–∑–∞ 5**: 2-3 —á–∞—Å–∞ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)
- **–§–∞–∑–∞ 6**: 3-4 —á–∞—Å–∞ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–ò—Ç–æ–≥–æ**: 13-21 —á–∞—Å –Ω–∞ –ø–æ–ª–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

‚úÖ –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π peerId –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úÖ DHT —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –ø–æ–∏—Å–∫
‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –ø–∏—Ä–æ–≤ (–±–µ–∑ –¥—É–±–ª–µ–π)
‚úÖ –ü—Ä—è–º—ã–µ P2P –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å fallback –Ω–∞ relay
‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
‚úÖ Pub/Sub —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö
‚úÖ –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

–í–∞—à P2P –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å:
- –ü—Ä—è–º—ã–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏ –º–µ–∂–¥—É –ø–∏—Ä–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –Ω–∞ relay
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º –¥—É–±–ª–µ–π –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- Eventual consistency –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
